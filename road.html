<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=713d8ed209034c808b0ca0fd35829761&libraries=services"></script>
        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=713d8ed209034c808b0ca0fd35829761&libraries=services,clusterer,drawing"></script>
        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=713d8ed209034c808b0ca0fd35829761"></script>
    </head>
    <body>
        <div id="map" style="width: 100%; height: 350px;"></div>
        <input type="text" id="address" placeholder="주소" />
        <button id="search">버튼</button>
        <p class="list"></p>

        <script>
            $(function () {
                var mapContainer = document.getElementById("map"),
                    mapOption = {
                        center: new kakao.maps.LatLng(37.5668260054796, 126.978656785931),
                        level: 10,
                    };
                var map = new kakao.maps.Map(mapContainer, mapOption);
                var data = [];
                var inputAddress = [];
                var marker = new kakao.maps.Marker({});
                var linePath = [];
                var positions = [];
                var xMax = 0;
                var xMin = 999;
                var yMax = 0;
                var yMin = 999;
                var polygonPath = [];

                function makeMarker(cxWeight, cyWeight) {
                    var markerPosition = new kakao.maps.LatLng(cxWeight, cyWeight);
                    marker.setMap(null);
                    marker = new kakao.maps.Marker({
                        position: markerPosition,
                    });
                    marker.setMap(map);
                }

                function middleCalculator(fx1, fy1) {
                    data = [...data, fx1, fy1];

                    for (var i = 0; i < data.length - i * 1; i++) {
                        if (xMax < parseFloat(data[2 * i])) {
                            xMax = parseFloat(data[2 * i]);
                        }

                        if (xMin > parseFloat(data[2 * i])) {
                            xMin = parseFloat(data[2 * i]);
                        }

                        if (yMax < parseFloat(data[2 * i + 1])) {
                            yMax = parseFloat(data[2 * i + 1]);
                        }

                        if (yMin > parseFloat(data[2 * i + 1])) {
                            yMin = parseFloat(data[2 * i + 1]);
                        }

                        //선표시
                        // linePath = [...linePath, new kakao.maps.LatLng(data[2 * i], data[2 * i + 1])];
                        // positions = [
                        //     {
                        //         ...positions,
                        //         latlng: new kakao.maps.LatLng(data[2 * i], data[2 * i + 1]),
                        //     },
                        // ];
                    }

                    // 무게중심 구하기
                    if (data.length < 5) {
                        // 직선 무게중심
                        console.log("line");
                        var cxWeight = (xMin + xMax) / 2;
                        var cyWeight = (yMin + yMax) / 2;
                    } else if (data.length < 7) {
                        // 삼각형 무게중심
                        console.log("triangle");
                        var cxWeight = (parseFloat(data[0]) + parseFloat(data[2]) + parseFloat(data[4])) / 3;
                        var cyWeight = (parseFloat(data[1]) + parseFloat(data[3]) + parseFloat(data[5])) / 3;
                    } else {
                        // 다각형 무게 중심
                        console.log("polygon");
                        var cxWeight = xMin + (xMax - xMin) / 2;
                        var cyWeight = yMin + (yMax - yMin) / 2;
                    }

                    polyGon(fx1, fy1);
                    makeMarker(cxWeight, cyWeight);
                }

                function polyLine() {
                    var polyline = new kakao.maps.Polyline({
                        path: linePath,
                        strokeWeight: 5,
                        strokeColor: "rgb(162, 0, 0)",
                        strokeOpacity: 0.7,
                        strokeStyle: "solid",
                    });

                    polyline.setMap(map);
                }

                function polyGon(coorx, coory) {
                    var ractangle2 = new kakao.maps.LatLng(coorx, coory);

                    polygonPath = [...polygonPath, ractangle2];

                    var polygon = new kakao.maps.Polygon({
                        path: polygonPath,
                        strokeWeight: 3,
                        strokeColor: "#39DE2A",
                        strokeOpacity: 0.8,
                        strokeStyle: "longdash",
                        fillColor: "#A2FF99",
                        fillOpacity: 0.7,
                    });

                    polygon.setMap(map);
                }

                function geoLocation(addr) {
                    var geocoder = new kakao.maps.services.Geocoder();
                    var callback = function (result, status) {
                        if (status === kakao.maps.services.Status.OK) {
                            result.map((data, index) => {
                                middleCalculator(data.y, data.x);
                            });
                        }
                    };
                    geocoder.addressSearch(addr, callback);
                }
                var address = $("#address");
                var address1 = $("#address1");
                var searchbtn = $("#search");

                address.keydown(function (key) {
                    if (key.keyCode == 13) {
                        geoLocation(address.val());
                        inputAddress = [...inputAddress, address.val()];
                        $(".list").text(inputAddress);
                        address.val("");
                    }
                });
                searchbtn.click(function (key) {
                    const object = [address1.val(), address.val()];
                    geoLocation("해남군 송지면");
                });
            });
        </script>
    </body>
</html>
